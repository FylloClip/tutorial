---
title: "code for Arduino"
---

Here you find the code (or 'sketch', as it is called in Arduino language), which you need to upload onto the microcontroller board. This sketch includes all the functions and routines for the system to operate.

There are a few things to explain about this sketch. It is designed to run the FylloClip module in ABP (activation by personalization) mode, which is one of two possibles modes of establishing a connection of a device to a LoRa network. This is not the officially recommended mode (which would be over the air activation, or OTAA), but it has the advantage of using a much more lightweight library (TinyLoRa) and that under some circumstances it might use less power.

The ABP mode of activating the device requires 3 unique identification keys to be inserted into the sketch before uploading it to the device. These are the **network session key** (NwkSkey), the **application session key** (AppSkey) and **device address** (DevAddr). You will obtain these codes when registering a new end device on the TTS console, after creating your own personal account there. It is important to copy and paste the keys in the hexadecimal format displaying an 0x in front of each number

In addition, for your own use, you can assign an ID-number from 0 - 99 to each device.

![*part of the Arduino sketch with the ID- number in line 11 and the identification keys in lines 15, 18 and 21.*](sketch.png){width="1000"}

![*TinyLora library*](tinylora.png)

![select the correct frequency band for your region by commenting/uncommenting the respective lines of code](frequency_settings.png){width="600"}

For uploading the code you need a FTDI adapter. On the adapter select 3.3V power supply by positioning the jumper

![*FTDI adapter*](images/FTDI.png)

If you have installed male pin headers on your microcontroller board, you need to solder a female pin connector onto your FTDI adapter:

![*FTDI adapter with modified connector pins*](images/FTDI_2.png){width="400"}

![*FTDI adapter connected to the microprocessor board for programming*](images/clipboard-2070729821.png){width="300"}

Before uploading the sketch make sure you have the correct board settings in the Arduino IDE: the selected board should be 'Arduino Pro or Pro Mini' with 'ATmega328P(3.3V 8 Mhz)' as processor. Make also sure you have selected the COM port to which the FTDI adapter is connected.

![*Board settings in the Arduino IDE*](images/clipboard-4191342988.png){width="500"}

Download link for the Arduino code:

[Arduino code](https://github.com/FylloClip/tutorial/blob/main/docs/Arduino%20code/FylloClip_2024/FylloClip_2024.ino)
